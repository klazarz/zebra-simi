<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zebra Sporting Goods</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <!-- Hero -->
    <div class="hero">
        <h1>Zebra Sporting Goods</h1>
        <h3>Your partner since 1902</h3>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Product Information</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

        <form method="POST" class="search-box input-group mt-4">
            <input type="text" name="search" class="form-control" placeholder="Search for products..."
                value="{{ search_query }}">
            <button type="submit" class="btn btn-light">Search</button>
        </form>
    </div>

    <!-- Product Cards -->
    {% if products %}
    <form id="buyForm" action="/buy" method="POST">
        <div class="container product-section">
            <div class="row justify-content-center g-4">
                {% for product in products %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card product-card shadow-sm h-100">
                        <img src="{{ url_for('static', filename='images/' + (product[0]|string) + '.jpeg') }}"
                            class="card-img-top" alt="{{ product[1] }}">
                        <div class="card-body text-center">
                            <h6 class="card-title" onclick="getProductInfo('{{ product[1] }}', '{{ product[1] }}')">{{ product[1] }}</h6>
                            <p class="card-text fw-bold text-primary">${{ product[3] }}</p>
                            <div class="form-check d-flex justify-content-center">
                                <input class="form-check-input" type="checkbox" name="selected_products"
                                    value="{{ product[0] }}" id="prod{{ loop.index }}">
                                <label class="form-check-label ms-2" for="prod{{ loop.index }}">Select</label>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg">Buy now!</button>
            </div>
        </div>
    </form>
    {% endif %}

    <!-- Footer -->
    <div class="footer">
        <a href="https://www.oracle.com" class="text-decoration-none">oracle.com</a> |
        powered by <img src="{{ url_for('static', filename='images/theo.png') }}" alt="O" />
        <a href="https://www.oracle.com/database/free/" class="text-decoration-none">Oracle Database 23ai free</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    function showModal() {
        document.getElementById('productModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('productModal').style.display = 'none';
        document.getElementById('modalContent').innerHTML = '';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('productModal');
        if (event.target == modal) {
            closeModal();
        }
    }

    function getProductInfo(productDesc, productTitle) {
        // Show modal and loading state
        showModal();
        document.getElementById('modalTitle').textContent = productTitle;
        document.getElementById('modalContent').innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                Finding testimonials...
            </div>
        `;
        
        fetch('/get_product_info', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_desc: productDesc
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('modalContent').innerHTML = `
                    <div class="error">Error: ${data.error}</div>
                `;
            } else {
                let cacheInfo = "";
                if (data.cached) {
    console.log('Original query:', data.original_query); // Debug line
    cacheInfo = `<div class="cache-info">
        <small>From semantic cache (similarity: ${(data.similarity_score * 100).toFixed(1)}%)<br>
       </small>
    </div>`;

                } else {
                    cacheInfo = `<div class="cache-info">
                        <small>New response (now cached for similar future queries)</small>
                    </div>`;
                }

                document.getElementById('modalContent').innerHTML = `
                    ${cacheInfo}
                    <div class="product-description">
                        ${data.response}
                    </div>
                `;
            }
        })
        .catch(error => {
            document.getElementById('modalContent').innerHTML = `
                <div class="error">Error: ${error.message}</div>
            `;
        });
    }
    </script>
</body>

</html>